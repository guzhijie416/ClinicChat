{
  "entities": {
    "Clinic": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Clinic",
      "type": "object",
      "description": "Represents a clinic and its associated information.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the clinic."
        },
        "name": {
          "type": "string",
          "description": "Name of the clinic."
        },
        "address": {
          "type": "string",
          "description": "Address of the clinic."
        },
        "hours": {
          "type": "string",
          "description": "Operating hours of the clinic."
        },
        "phone": {
          "type": "string",
          "description": "Phone number of the clinic."
        },
        "faqIds": {
          "type": "array",
          "description": "References to FAQs. (Relationship: Clinic 1:N FAQ)",
          "items": {
            "type": "string"
          }
        },
        "staffIds": {
          "type": "array",
          "description": "References to Staff. (Relationship: Clinic 1:N Staff)",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "id",
        "name",
        "address",
        "hours",
        "phone"
      ]
    },
    "FAQ": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "FAQ",
      "type": "object",
      "description": "Represents a frequently asked question and its answer.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the FAQ."
        },
        "clinicId": {
          "type": "string",
          "description": "Reference to Clinic. (Relationship: Clinic 1:N FAQ)"
        },
        "question": {
          "type": "string",
          "description": "The frequently asked question."
        },
        "answer": {
          "type": "string",
          "description": "The answer to the frequently asked question."
        }
      },
      "required": [
        "id",
        "clinicId",
        "question",
        "answer"
      ]
    },
    "Staff": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Staff",
      "type": "object",
      "description": "Represents a staff member at the clinic.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the staff member."
        },
        "clinicId": {
          "type": "string",
          "description": "Reference to Clinic. (Relationship: Clinic 1:N Staff)"
        },
        "name": {
          "type": "string",
          "description": "Name of the staff member."
        },
        "availability": {
          "type": "string",
          "description": "Availability schedule of the staff member."
        }
      },
      "required": [
        "id",
        "clinicId",
        "name",
        "availability"
      ]
    },
    "ChatSession": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "ChatSession",
      "type": "object",
      "description": "Represents a chat session between a client and the AI.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the chat session."
        },
        "clinicId": {
          "type": "string",
          "description": "Reference to Clinic. (Relationship: ChatSession 1:1 Clinic)"
        },
        "clientId": {
          "type": "string",
          "description": "Identifier of the client initiating the chat. Can be null if the client is anonymous."
        },
        "startTime": {
          "type": "string",
          "description": "Timestamp indicating when the chat session started.",
          "format": "date-time"
        },
        "endTime": {
          "type": "string",
          "description": "Timestamp indicating when the chat session ended. Can be null if the session is still active.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "clinicId",
        "startTime"
      ]
    },
    "ChatMessage": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "ChatMessage",
      "type": "object",
      "description": "Represents a single message within a chat session.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the chat message."
        },
        "chatSessionId": {
          "type": "string",
          "description": "Reference to ChatSession. (Relationship: ChatSession 1:N ChatMessage)"
        },
        "sender": {
          "type": "string",
          "description": "Indicates who sent the message (e.g., 'client', 'ai')."
        },
        "message": {
          "type": "string",
          "description": "The content of the chat message."
        },
        "timestamp": {
          "type": "string",
          "description": "Timestamp of when the message was sent.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "chatSessionId",
        "sender",
        "message",
        "timestamp"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/clinics/{clinicId}",
        "definition": {
          "entityName": "Clinic",
          "schema": {
            "$ref": "#/backend/entities/Clinic"
          },
          "description": "Stores clinic information.  Supports listing clinics with public information.",
          "params": [
            {
              "name": "clinicId",
              "description": "Unique identifier for the clinic."
            }
          ]
        }
      },
      {
        "path": "/clinics/{clinicId}/faqs/{faqId}",
        "definition": {
          "entityName": "FAQ",
          "schema": {
            "$ref": "#/backend/entities/FAQ"
          },
          "description": "Stores FAQs related to a specific clinic. Includes denormalized 'clinicId' for authorization independence.",
          "params": [
            {
              "name": "clinicId",
              "description": "Unique identifier for the clinic."
            },
            {
              "name": "faqId",
              "description": "Unique identifier for the FAQ."
            }
          ]
        }
      },
      {
        "path": "/clinics/{clinicId}/staff/{staffId}",
        "definition": {
          "entityName": "Staff",
          "schema": {
            "$ref": "#/backend/entities/Staff"
          },
          "description": "Stores staff information for a specific clinic. Includes denormalized 'clinicId' for authorization independence.",
          "params": [
            {
              "name": "clinicId",
              "description": "Unique identifier for the clinic."
            },
            {
              "name": "staffId",
              "description": "Unique identifier for the staff member."
            }
          ]
        }
      },
      {
        "path": "/clinics/{clinicId}/chat_sessions/{chatSessionId}",
        "definition": {
          "entityName": "ChatSession",
          "schema": {
            "$ref": "#/backend/entities/ChatSession"
          },
          "description": "Stores chat sessions related to a clinic. Includes denormalized 'clinicId' for authorization independence.",
          "params": [
            {
              "name": "clinicId",
              "description": "Unique identifier for the clinic."
            },
            {
              "name": "chatSessionId",
              "description": "Unique identifier for the chat session."
            }
          ]
        }
      },
      {
        "path": "/clinics/{clinicId}/chat_sessions/{chatSessionId}/messages/{messageId}",
        "definition": {
          "entityName": "ChatMessage",
          "schema": {
            "$ref": "#/backend/entities/ChatMessage"
          },
          "description": "Stores chat messages within a chat session. Includes denormalized 'clinicId' and 'chatSessionId' for authorization independence.",
          "params": [
            {
              "name": "clinicId",
              "description": "Unique identifier for the clinic."
            },
            {
              "name": "chatSessionId",
              "description": "Unique identifier for the chat session."
            },
            {
              "name": "messageId",
              "description": "Unique identifier for the chat message."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to support the ClinicChat application, focusing on efficient data retrieval and secure access. Authorization Independence is achieved by storing the clinic ID directly within the FAQ, Staff, ChatSession, and ChatMessage documents, eliminating the need for hierarchical `get()` calls in security rules and enabling atomic operations. Structural Segregation is maintained by placing FAQs and Staff documents in subcollections of `/clinics/{clinicId}`, enabling simple path-based rules. ChatSessions and ChatMessages are similarly segregated under `/clinics/{clinicId}/chat_sessions/{chatSessionId}`. This approach ensures that all documents within each collection share the same security requirements, simplifying security rule management and improving overall security posture.\n\nThe structure supports the required QAPs (Rules are not Filters) via structural segregation and path-based rules.\n\n*   `/clinics/{clinicId}`: Allows listing clinics with public info (name, address, hours, phone). Security rules can restrict creation/modification to authorized users.\n*   `/clinics/{clinicId}/faqs/{faqId}`: Allows listing FAQs related to a specific clinic. Security rules ensure only authorized users can create/modify/delete FAQs.\n*   `/clinics/{clinicId}/staff/{staffId}`: Allows listing staff members associated with a clinic. Security rules control who can manage staff information.\n*   `/clinics/{clinicId}/chat_sessions/{chatSessionId}`: Secures chat sessions to the clinic and participating users.\n*   `/clinics/{clinicId}/chat_sessions/{chatSessionId}/messages/{messageId}`: Secures chat messages within a chat session."
  }
}