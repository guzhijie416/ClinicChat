{
  "entities": {
    "Clinic": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Clinic",
      "type": "object",
      "description": "Represents a clinic that uses the application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the clinic entity."
        },
        "name": {
          "type": "string",
          "description": "Name of the clinic."
        },
        "address": {
          "type": "string",
          "description": "Address of the clinic."
        },
        "hours": {
          "type": "string",
          "description": "Operating hours of the clinic."
        },
        "phoneNumber": {
          "type": "string",
          "description": "Phone number of the clinic."
        }
      },
      "required": [
        "id",
        "name",
        "address",
        "hours",
        "phoneNumber"
      ]
    },
    "Staff": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Staff",
      "type": "object",
      "description": "Represents a staff member at the clinic.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the staff member."
        },
        "clinicId": {
          "type": "string",
          "description": "Reference to Clinic. (Relationship: Clinic 1:N Staff)"
        },
        "name": {
          "type": "string",
          "description": "Name of the staff member."
        },
        "availableToday": {
          "type": "boolean",
          "description": "Indicates whether the staff member is available today."
        }
      },
      "required": [
        "id",
        "clinicId",
        "name",
        "availableToday"
      ]
    },
    "FAQ": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "FAQ",
      "type": "object",
      "description": "Represents a frequently asked question.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the FAQ."
        },
        "clinicId": {
          "type": "string",
          "description": "Reference to Clinic. (Relationship: Clinic 1:N FAQ)"
        },
        "question": {
          "type": "string",
          "description": "The FAQ question."
        },
        "answer": {
          "type": "string",
          "description": "The answer to the FAQ question."
        }
      },
      "required": [
        "id",
        "clinicId",
        "question",
        "answer"
      ]
    },
    "ChatSession": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "ChatSession",
      "type": "object",
      "description": "Represents a chat session between a client and the AI.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the chat session."
        },
        "clinicId": {
          "type": "string",
          "description": "Reference to Clinic. (Relationship: Clinic 1:N ChatSession)"
        },
        "startTime": {
          "type": "string",
          "description": "The starting time of the chat session.",
          "format": "date-time"
        },
        "endTime": {
          "type": "string",
          "description": "The ending time of the chat session. It is null if the chat is active.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "clinicId",
        "startTime"
      ]
    },
    "ChatMessage": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "ChatMessage",
      "type": "object",
      "description": "Represents a message within a chat session.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the chat message."
        },
        "chatSessionId": {
          "type": "string",
          "description": "Reference to ChatSession. (Relationship: ChatSession 1:N ChatMessage)"
        },
        "senderType": {
          "type": "string",
          "description": "Indicates who sent the message (e.g., 'client', 'ai')."
        },
        "messageText": {
          "type": "string",
          "description": "The content of the message."
        },
        "timestamp": {
          "type": "string",
          "description": "The time the message was sent.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "chatSessionId",
        "senderType",
        "messageText",
        "timestamp"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/clinics/{clinicId}",
        "definition": {
          "entityName": "Clinic",
          "schema": {
            "$ref": "#/backend/entities/Clinic"
          },
          "description": "Stores clinic information.",
          "params": [
            {
              "name": "clinicId",
              "description": "Unique identifier for the clinic."
            }
          ]
        }
      },
      {
        "path": "/clinics/{clinicId}/staff/{staffId}",
        "definition": {
          "entityName": "Staff",
          "schema": {
            "$ref": "#/backend/entities/Staff"
          },
          "description": "Stores staff information for a specific clinic.",
          "params": [
            {
              "name": "clinicId",
              "description": "Unique identifier for the clinic."
            },
            {
              "name": "staffId",
              "description": "Unique identifier for the staff member."
            }
          ]
        }
      },
      {
        "path": "/clinics/{clinicId}/faqs/{faqId}",
        "definition": {
          "entityName": "FAQ",
          "schema": {
            "$ref": "#/backend/entities/FAQ"
          },
          "description": "Stores FAQs for a specific clinic.",
          "params": [
            {
              "name": "clinicId",
              "description": "Unique identifier for the clinic."
            },
            {
              "name": "faqId",
              "description": "Unique identifier for the FAQ."
            }
          ]
        }
      },
      {
        "path": "/clinics/{clinicId}/chatSessions/{chatSessionId}",
        "definition": {
          "entityName": "ChatSession",
          "schema": {
            "$ref": "#/backend/entities/ChatSession"
          },
          "description": "Stores chat sessions for a specific clinic.",
          "params": [
            {
              "name": "clinicId",
              "description": "Unique identifier for the clinic."
            },
            {
              "name": "chatSessionId",
              "description": "Unique identifier for the chat session."
            }
          ]
        }
      },
      {
        "path": "/clinics/{clinicId}/chatSessions/{chatSessionId}/chatMessages/{chatMessageId}",
        "definition": {
          "entityName": "ChatMessage",
          "schema": {
            "$ref": "#/backend/entities/ChatMessage"
          },
          "description": "Stores chat messages for a specific chat session.",
          "params": [
            {
              "name": "clinicId",
              "description": "Unique identifier for the clinic."
            },
            {
              "name": "chatSessionId",
              "description": "Unique identifier for the chat session."
            },
            {
              "name": "chatMessageId",
              "description": "Unique identifier for the chat message."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to support the ClinicChat application, focusing on secure and efficient data access for clinic information, staff details, FAQs, and chat sessions. The design emphasizes authorization independence and clear access patterns. Each clinic has its own collection for storing relevant data, enabling easy management and isolation.\n\n**Authorization Independence (CRITICAL):** All data related to a clinic is stored under its respective `clinicId`. This avoids cross-collection `get()` calls in security rules and ensures that authorization can be determined based on the path and data within each document.\n\n**Structural Segregation (Homogeneous Security Posture):** Data with different access needs is separated into different collections. This simplifies security rules. For example, all documents within `/clinics/{clinicId}/staff` will have similar access control requirements.\n\n**Access Modeling (Standardization and Consistency):** Path-based ownership is used for clinic-specific data. The structure `/clinics/{clinicId}/staff/{staffId}` clearly indicates that the staff document belongs to the specified clinic. This simplifies ownership-based security rules.\n\n**QAPs (Rules are not Filters):** The segregation strategy ensures efficient `list` operations. Listing staff, FAQs, or chat sessions for a specific clinic can be done securely by querying the relevant subcollection under that clinic's document."
  }
}